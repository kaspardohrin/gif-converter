{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/kaspar/Documents/cmgt/specialisatie-block/react-tsc/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/kaspar/Documents/cmgt/specialisatie-block/react-tsc/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/kaspar/Documents/cmgt/specialisatie-block/react-tsc/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import React,{useEffect}from'react';import{createFFmpeg,fetchFile}from'@ffmpeg/ffmpeg';import'./Converter.scss';var ffmpeg=createFFmpeg();export var Converter=function Converter(){var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),ready=_React$useState2[0],ready_set=_React$useState2[1];var _React$useState3=React.useState('0'),_React$useState4=_slicedToArray(_React$useState3,2),start=_React$useState4[0],start_set=_React$useState4[1];var _React$useState5=React.useState('5'),_React$useState6=_slicedToArray(_React$useState5,2),length=_React$useState6[0],length_set=_React$useState6[1];var _React$useState7=React.useState(0),_React$useState8=_slicedToArray(_React$useState7,2),video_length=_React$useState8[0],video_length_set=_React$useState8[1];var _React$useState9=React.useState(),_React$useState10=_slicedToArray(_React$useState9,2),video=_React$useState10[0],video_set=_React$useState10[1];var _React$useState11=React.useState(''),_React$useState12=_slicedToArray(_React$useState11,2),gif=_React$useState12[0],gif_set=_React$useState12[1];var _React$useState13=React.useState(false),_React$useState14=_slicedToArray(_React$useState13,2),converting=_React$useState14[0],converting_set=_React$useState14[1];useEffect(function(){load();},[/*empty array prevents it from running again*/]);var load=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!ffmpeg.isLoaded()){_context.next=2;break;}return _context.abrupt(\"return\",ready_set(true));case 2:_context.next=4;return ffmpeg.load();case 4:ready_set(true);case 5:case\"end\":return _context.stop();}}},_callee);}));return function load(){return _ref.apply(this,arguments);};}();var video_length_get=function video_length_get(event){// @ts-ignore\nvar input=event.target.duration;var value=Number(String(input).split(/\\./g)[0]);video_length_set(value);};var begin_update=function begin_update(event){var input=Number(event.target.value);var n_length=Number(length);if(!video)return;if(input<0)return start_set('0');if(input>video_length)input=video_length-1;start_set(\"\".concat(video_length-1));if(n_length+input-1>video_length)length_set(\"\".concat(video_length-input));if(input>=video_length)return;start_set(\"\".concat(input));};var length_update=function length_update(event){var input=Number(event.target.value);var n_begin=Number(start);if(!video)return;if(input<1)return length_set('1');if(input>video_length)input=video_length;length_set(\"\".concat(video_length));if(n_begin+input>video_length)start_set(\"\".concat(video_length-input));if(input>=video_length)return;length_set(\"\".concat(input));};var video_update=function video_update(event){var _event$target$files;var video=(_event$target$files=event.target.files)===null||_event$target$files===void 0?void 0:_event$target$files.item(0);if(video.name.split(/\\./g).pop()!=='mp4'&&video.type!=='video/mp4')return;video_set(video);};var convert=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var data,url;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(video){_context2.next=2;break;}return _context2.abrupt(\"return\");case 2:converting_set(true);_context2.t0=ffmpeg;_context2.next=6;return fetchFile(video);case 6:_context2.t1=_context2.sent;_context2.next=9;return _context2.t0.FS.call(_context2.t0,'writeFile','test.mp4',_context2.t1);case 9:_context2.next=11;return ffmpeg.run('-i','test.mp4','-t',\"\".concat(length),'-ss',\"\".concat(start),'-f','gif','out.gif');case 11:converting_set(false);data=ffmpeg.FS('readFile','out.gif');url=URL.createObjectURL(new Blob([data.buffer],{type:'image/gif'}));gif_set(url);case 15:case\"end\":return _context2.stop();}}},_callee2);}));return function convert(){return _ref2.apply(this,arguments);};}();return ready?/*#__PURE__*/_jsxs(\"div\",{className:\"media-container\",children:[video?/*#__PURE__*/_jsx(\"video\",{controls:true,src:URL.createObjectURL(video),onLoadedMetadata:function onLoadedMetadata(e){return video_length_get(e);}}):/*#__PURE__*/_jsx(\"div\",{className:\"placeholder-video\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"control-panel\",children:[/*#__PURE__*/_jsx(\"input\",{onChange:video_update,type:\"file\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Start:\"}),/*#__PURE__*/_jsx(\"input\",{onChange:begin_update,type:\"number\",placeholder:start,value:start}),/*#__PURE__*/_jsx(\"span\",{children:\"Duration:\"}),/*#__PURE__*/_jsx(\"input\",{onChange:length_update,type:\"number\",placeholder:length,value:length}),/*#__PURE__*/_jsx(\"button\",{onClick:convert,children:\"Convert\"})]}),gif?/*#__PURE__*/_jsx(\"img\",{src:gif,width:\"250\",alt:\"gif of the video you've uploaded\"}):/*#__PURE__*/_jsx(\"div\",{className:\"placeholder-gif\",children:/*#__PURE__*/_jsx(\"div\",{className:\"\".concat(converting?'loading':'')})})]}):/*#__PURE__*/_jsx(\"div\",{className:\"loading-screen\",children:/*#__PURE__*/_jsx(\"div\",{id:\"spinner\"})});};","map":{"version":3,"sources":["C:/Users/kaspar/Documents/cmgt/specialisatie-block/react-tsc/src/components/Converter.tsx"],"names":["React","useEffect","createFFmpeg","fetchFile","ffmpeg","Converter","useState","ready","ready_set","start","start_set","length","length_set","video_length","video_length_set","video","video_set","gif","gif_set","converting","converting_set","load","isLoaded","video_length_get","event","input","target","duration","value","Number","String","split","begin_update","n_length","length_update","n_begin","video_update","files","item","name","pop","type","convert","FS","run","data","url","URL","createObjectURL","Blob","buffer","e"],"mappings":"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","sourcesContent":["import React, { useEffect, ChangeEvent } from 'react'\r\nimport { createFFmpeg, fetchFile, FFmpeg } from '@ffmpeg/ffmpeg'\r\n\r\nimport './Converter.scss'\r\n\r\ninterface Props { }\r\n\r\nconst ffmpeg: FFmpeg = createFFmpeg(/*{log: true}*/)\r\n\r\nexport const Converter: React.FC<Props> = () => {\r\n  const [ready, ready_set] = React.useState<boolean>(false)\r\n\r\n  const [start, start_set] = React.useState<string>('0')\r\n  const [length, length_set] = React.useState<string>('5')\r\n  const [video_length, video_length_set] = React.useState<number>(0)\r\n\r\n  const [video, video_set] = React.useState<any>()\r\n  const [gif, gif_set] = React.useState<string>('')\r\n\r\n  const [converting, converting_set] = React.useState<boolean>(false)\r\n\r\n  useEffect(() => {load()}, [/*empty array prevents it from running again*/])\r\n\r\n  const load = async (): Promise<void> => {\r\n    if (ffmpeg.isLoaded()) return ready_set(true)\r\n\r\n    await ffmpeg.load(); ready_set(true)\r\n  }\r\n\r\n  const video_length_get = (event: React.SyntheticEvent<HTMLVideoElement, Event>): any => {\r\n    // @ts-ignore\r\n    const input: number = event.target.duration\r\n\r\n    const value: number = Number(String(input).split(/\\./g)[0])\r\n\r\n    video_length_set(value)\r\n  }\r\n\r\n  const begin_update = (event: ChangeEvent<HTMLInputElement>) => {\r\n    let input: number = Number(event.target.value)\r\n    let n_length: number = Number(length)\r\n\r\n    if (!video) return\r\n\r\n    if (input < 0) return start_set('0')\r\n\r\n    if (input > video_length) input = video_length - 1; start_set(`${video_length - 1}`)\r\n\r\n    if ((n_length + input - 1) > video_length) length_set(`${video_length - input}`)\r\n\r\n    if (input >= video_length) return\r\n\r\n    start_set(`${input}`)\r\n  }\r\n\r\n  const length_update = (event: ChangeEvent<HTMLInputElement>) => {\r\n    let input: number = Number(event.target.value)\r\n    let n_begin: number = Number(start)\r\n\r\n    if (!video) return\r\n\r\n    if (input < 1) return length_set('1')\r\n\r\n    if (input > video_length) input = video_length; length_set(`${video_length}`)\r\n\r\n    if ((n_begin + input) > video_length) start_set(`${video_length - input}`)\r\n\r\n    if (input >= video_length) return\r\n\r\n    length_set(`${input}`)\r\n  }\r\n\r\n  const video_update = (event: ChangeEvent<HTMLInputElement>) => {\r\n    const video: any = event.target.files?.item(0)!\r\n\r\n    if (\r\n      video.name.split(/\\./g).pop() !== 'mp4'\r\n      && video.type !== 'video/mp4'\r\n    ) return\r\n\r\n    video_set(video)\r\n  }\r\n\r\n  const convert = async (): Promise<void> => {\r\n    if (!video) return\r\n\r\n    converting_set(true)\r\n\r\n    await ffmpeg.FS('writeFile', 'test.mp4', await fetchFile(video))\r\n    await ffmpeg.run('-i', 'test.mp4', '-t', `${length}`, '-ss', `${start}`, '-f', 'gif', 'out.gif')\r\n\r\n    converting_set(false)\r\n\r\n    const data: Buffer = ffmpeg.FS('readFile', 'out.gif')\r\n    const url: string = URL.createObjectURL(new Blob([data.buffer], { type: 'image/gif' }))\r\n\r\n    gif_set(url)\r\n  }\r\n\r\n    return ready\r\n    ? (\r\n      <div className='media-container'>\r\n        {\r\n          (video)\r\n              ? <video controls src={URL.createObjectURL(video)} onLoadedMetadata={(e) => video_length_get(e)}></video>\r\n            : <div className='placeholder-video'></div>\r\n          }\r\n\r\n        <div className='control-panel'>\r\n          <input onChange={video_update} type='file' />\r\n          <span>Start:</span>\r\n          <input onChange={begin_update} type='number' placeholder={start} value={start} />\r\n          <span>Duration:</span>\r\n          <input onChange={length_update} type='number' placeholder={length} value={length} />\r\n          <button onClick={convert}>Convert</button>\r\n        </div>\r\n        {\r\n          (gif)\r\n              ? <img src={gif} width='250' alt={`gif of the video you've uploaded`} />\r\n              : <div className={`placeholder-gif`}>\r\n                  <div className={`${(converting) ? 'loading' : ''}`}></div>\r\n                </div>\r\n        }\r\n      </div>\r\n      ) : (\r\n      <div className='loading-screen'>\r\n        <div id=\"spinner\" />\r\n      </div>\r\n    )\r\n}\r\n"]},"metadata":{},"sourceType":"module"}